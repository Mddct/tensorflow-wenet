<?xml version="1.0" encoding="UTF-8"?>
<!-- Do not edit this file with editors other than diagrams.net -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="721px" height="506px" viewBox="-0.5 -0.5 721 506" content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2022-12-06T12:05:33.012Z&quot; agent=&quot;5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36&quot; etag=&quot;1KFe0g20oV7Y6D4ddglO&quot; version=&quot;20.4.1&quot; type=&quot;google&quot;&gt;&lt;diagram id=&quot;fN6srnEWSI2P8TogVT1-&quot; name=&quot;第 1 页&quot;&gt;3Vnbjts2EP0aAkkBFbpYsvQo2d4uijYvQRHkyaAlrsSuTCoUba/z9R1eZFuWvBdkb91gEdPD4VA8MzwzY6Fgtr77Q+Cm+psXpEa+W9yhYI58P5lE8L8S7I0g8j0jKAUtjOhE8JX+JFboWumGFqTtKUrOa0mbvjDnjJFc9mRYCL7rq93wur9rg0syEHzNcT2UfqOFrIw09qdH+TWhZdXt7EWJmVnjTtmepK1wwXcnomCBgpngXJrR+m5GaoVdh4tZd3Vh9vBggjD5mAW7f67nX+ps5WXX5Nv37Ze8+XPvBMbKFtcbe2D7sHLfIUAKAMR+5UJWvOQM14ujNBN8wwqitnHh21HnL84bEHog/JdIubfexRvJQVTJdW1nzZ5qo4tns6KWb0RO7jlQFyNYlETeo+cfPACRS/iaSLGHdYLUWNJt/zmwjaHyoHeEGQYW6Seg7g1Qh+AQxQD6PrC7ikrytcH6/Du4bX0QbziTFmFvcgB1S4Qkd/fDOoTBLjjcQnt5A/t1d7wJXhfe1cktiNwXAi56F+F6grQ/ed7w9R8ZvuFbhq8/8AJlkoiaYNj5vcXw5L3F8GQkhqMads0Kuu1hF/3YqOSQweGlg2taMhSkoFGTG6nB6RRgVNpPbahtMBu1tML5bak94uS85sLYo4xKiutRk67JXAI+0GKKkglKY7SYoCxF8QItQhTHKI70IEGZrwcLlFypQTpFcYYWEUpCBIZgEM9R2q1SEtCZoCTVBmOUpoI0Nc0xWlyhbKaUOo2y2SjUjwvA6Ew9xFESautetzbpwIB1Bo8+RiDWePel79EFnp4/XjDALVbYpoEaJFMFrxXC0UcAp1yhk/gonumBq103VbrpXGllgJ2nJODbOPswwKlr5jkrLPNKUQYEl+A5aVu9MsJrRT5s1Tb9w/2/z/ygSc3ATmsoODW4XLKE/CC5DM4NrSEowYJzQFPLBWnhW03OxEPI3ZsVZrdDAyoBCroenWgbki/bzeps5nf492F8CEW5u9rkt1ABwEDlspb82BCWE/0grJQqnpE/09c+0bddcyPwYRppms4UnypWnak/JQG+nmhqAKGhYGDOEC2AFVyUzBV9xEAAmkgz4AZPKQOdZlGnM/swAE90u8k3TYfvjjLVm9nUYXCdKH6MF0GXnDRTAjtmV2yzXtpMtaRs2e5ZfshY7DdIVe3HS0KHFG3otIdUrMIvSXTAuCp41OAKxVeHRWXNV7jWj0KarpToIhJQil2b0eOko2sI+ZHYvh/OZz1vqO+DCYTEZkx7r0wO/Tj3QdUPI2nSODlJLe2qYnhTqk5H5k88+llPoM6KeoW/Pfg8J6rQAYGq+eF+1amdWNOiMN0baelPvNKmVEfRcKiNdI0eZiicK1vQsLW2iVA4ScFvycwgMWecEZO76nPRaFf3S71H1G89/CQc9B5RMtJ7+JOXaj7ij95Ah49soKdv2UCHAy+Mlqnnnnmgee675QVa6ei9tdLe8Ie0Nw5n75nDefrIcPbccc+9TjxPL/6kUQXjKYrfOUDRlJVdcqqIoLbEX8Nhqc2CWyw+OU5Btq3qWqrAMZOfjSaHcL6p1Y/qSreCFEGY7R9UNu1Pwzlo09L2dBOHspoy4hBWGCVn4jZ3RqPBRQEPOFA5apxkV1GuPgW+KcmDwH5Gn08e5iS1t+BOe9bxXK2s+WFozJwOPp+lb1fwM2SBPlqIMnA6Zz3NAkvsmMR76gjdZixX+2XXYiy7BuNkrXX+kxY9slhRd8fZWbJQZ2dcrC+UKYeeaHzrBwoSFYoX6pEnEeszEGl4Vhh48ZBJ/ddl0vfxIugFmbTLXQ9T6du+GnIHjhjrVJ8YwS9QDATTh2P4lauB4XuJXy+qXgA57xWRg6/HN8x67uQ1fbD4Dw==&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs/><g><path d="M 270 30 L 343.63 30" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 348.88 30 L 341.88 33.5 L 343.63 30 L 341.88 26.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="150" y="0" width="120" height="60" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 30px; margin-left: 151px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">shard</div></div></div></foreignObject><text x="210" y="34" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">shard</text></switch></g><path d="M 470 30 L 543.63 30" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 548.88 30 L 541.88 33.5 L 543.63 30 L 541.88 26.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="350" y="0" width="120" height="60" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 30px; margin-left: 351px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">interleave</div></div></div></foreignObject><text x="410" y="34" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">interleave</text></switch></g><rect x="0" y="265" width="690" height="240" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 385px; margin-left: 345px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 24px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;"><div style="text-align: left;"><span style="background-color: initial;">0 shar 用于分割原始数据到多个replica（多gpu/多机多卡）</span></div><div style="text-align: left;"><span style="background-color: initial;">1 interleave 解藕 读数据io和后续流程</span></div><div style="text-align: left;"><span style="background-color: initial;">2 1-batch preprocess: </span></div><div style="text-align: left;"><span style="background-color: initial;"><span style="white-space: pre;">	</span>filter -&gt;resample-&gt;  fbank -&gt; trim -&gt; spec_sub-&gt;....</span></div><div style="text-align: left;"><span style="background-color: initial;">3 bucket by sequence length , 长度相似的放入”自己桶“</span></div><div style="text-align: left;"><span style="background-color: initial;">4 group by window， 从3中拿num_replica_in_sync（n*gpus）</span></div><div style="text-align: left;"><span style="background-color: initial;">个batch， 这样每个global step 的所有batch seq长度</span><span style="background-color: initial;">几乎相同</span></div><div style="text-align: left;"><span style="background-color: initial;">5 batch preprocess： spec aug etc</span></div></div></div></div></foreignObject><text x="345" y="392" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="24px" text-anchor="middle">0 shar 用于分割原始数据到多个replica（多gpu/多机多卡）...</text></switch></g><path d="M 610 60 L 610 143.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 610 148.88 L 606.5 141.88 L 610 143.63 L 613.5 141.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="550" y="0" width="120" height="60" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 30px; margin-left: 551px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">1-batch preprocess</div></div></div></foreignObject><text x="610" y="34" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">1-batch preprocess</text></switch></g><path d="M 500 180 L 436.37 180" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 431.12 180 L 438.12 176.5 L 436.37 180 L 438.12 183.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="500" y="150" width="220" height="60" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 218px; height: 1px; padding-top: 180px; margin-left: 501px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><h3 id="bucket_by_sequence_length" data-text="bucket_by_sequence_length" role="presentation" style="box-sizing: inherit; margin: var(--devsite-h3-margin); overflow: hidden; text-overflow: ellipsis; margin-inline-end: -40px; padding-inline-end: 40px; color: rgb(32, 33, 36); text-align: start; background-color: rgb(255, 255, 255);"><span style="font-weight: normal;">bucket _by_sequence_length</span></h3></div></div></div></foreignObject><text x="610" y="184" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">bucket _by_sequence_length</text></switch></g><path d="M 310 180 L 236.37 180" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 231.12 180 L 238.12 176.5 L 236.37 180 L 238.12 183.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="310" y="150" width="120" height="60" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 180px; margin-left: 311px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">group by window</div></div></div></foreignObject><text x="370" y="184" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">group by window</text></switch></g><rect x="110" y="150" width="120" height="60" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 180px; margin-left: 111px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">batch preprocess</div></div></div></foreignObject><text x="170" y="184" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">batch preprocess</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>